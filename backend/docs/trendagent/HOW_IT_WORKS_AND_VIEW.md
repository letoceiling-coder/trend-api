# Как всё работает и как посмотреть результат

## Как устроен проект (схема)

```
trendagent.ru (внешний сайт)
       │
       │  API (api.trendagent.ru, apartment-api, …)
       ▼
┌──────────────────────────────────────────────────────────────┐
│  Ваш сервер (trendagent.siteaccess.ru)                       │
│                                                              │
│  Backend (Laravel)                                            │
│  • Синхронизирует данные с TrendAgent API в таблицы ta_*     │
│  • Команды/очередь: sync blocks, apartments, detail         │
│  • Отдаёт свои API: /api/ta/blocks, /api/ta/apartments, …    │
│       │                                                      │
│       │  /api/ta/*  (ваш API, свои данные)                   │
│       ▼                                                      │
│  Frontend (Vue SPA) — список, таблица, карта, карточки       │
│  • Читает только из вашего API (не напрямую trendagent.ru)  │
└──────────────────────────────────────────────────────────────┘
```

- **trendagent.ru** — оригинальный сайт TrendAgent (чужий сервис).
- **Ваш проект** — свой бэкенд (Laravel) и свой фронтенд (Vue). Данные **сначала** забираются с TrendAgent API в вашу БД (таблицы `ta_*`), **потом** отображаются через ваш API и ваш интерфейс.

---

## Что уже развёрнуто на сервере

| Компонент | Статус | Где смотреть |
|-----------|--------|--------------|
| **Backend API** | ✅ Работает | https://trendagent.siteaccess.ru/api/… |
| **Frontend (интерфейс)** | ⚠️ Не отдаётся с сервера | Сейчас только API, UI нужно запускать отдельно (см. ниже) |

То есть «посмотреть как на trendagent.ru» через один только домен **https://trendagent.siteaccess.ru** в браузере пока нельзя: там отдаётся только API (и при прямом заходе на корень — Laravel welcome/404), а не готовые страницы списков и карточек.

---

## Какие типы объектов и страниц есть в нашем фронтенде

По смыслу — те же типы, что на trendagent.ru (список, таблица, карта, планировки, шахматка, карточка объекта/квартиры), но реализованы не все разделы.

| Тип страницы | URL во фронтенде | Что показывает | API бэкенда |
|--------------|------------------|----------------|-------------|
| **Список комплексов** | `/objects/list` | Карточки ЖК (блоков) | GET /api/ta/blocks |
| **Таблица квартир** | `/objects/table` | Таблица квартир | GET /api/ta/apartments |
| **Карта** | `/objects/map` | Карта с объектами | GET /api/ta/blocks (с координатами) |
| **Планировки** | `/objects/plans` | Сетка планировок | blocks + apartments |
| **Шахматка по корпусу** | `/object/:blockId/checkerboard` | Этаж × секция, квартиры | GET /api/ta/apartments?block_id=… |
| **Карточка комплекса** | `/object/:blockId` | Детали ЖК, вкладки | GET /api/ta/blocks/:id + detail |
| **Карточка квартиры** | `/flat/:apartmentId` | Детали квартиры | GET /api/ta/apartments/:id + detail |
| **Админка TA** | `/admin/ta` | Health, sync runs, pipeline | /api/ta/admin/* (с X-Internal-Key) |

Парковки, посёлки, коммерция и т.п. на trendagent.ru есть, но в **нашем** фронтенде могут быть не реализованы или частично — смотрите пункты меню в самом UI.

---

## Как посмотреть результат (все типы объектов)

Данные для отображения берутся из **вашего API** (он уже на https://trendagent.siteaccess.ru). Чтобы увидеть списки и карточки «как на trendagent.ru», нужен **ваш же фронтенд**, подключённый к этому API.

### Вариант 1: Запуск фронтенда у себя на компьютере (проще всего)

1. Установить зависимости и запустить dev-сервер:

   ```bash
   cd frontend
   npm install
   npm run dev
   ```

2. Указать, что API — продовый:

   В папке `frontend/` создать файл `.env` (или `.env.local`) с одной строкой:

   ```env
   VITE_API_URL=https://trendagent.siteaccess.ru
   ```

   Перезапустить `npm run dev`.

3. В браузере открыть: **http://localhost:5173**

Дальше по ссылкам в интерфейсе:

- **Список комплексов:** http://localhost:5173/objects/list  
- **Таблица квартир:** http://localhost:5173/objects/table  
- **Карта:** http://localhost:5173/objects/map  
- **Планировки:** http://localhost:5173/objects/plans  
- **Комплекс (карточка):** http://localhost:5173/object/{block_id} (подставьте реальный `block_id` из списка)  
- **Квартира (карточка):** http://localhost:5173/flat/{apartment_id}  
- **Шахматка по корпусу:** http://localhost:5173/object/{block_id}/checkerboard  
- **Админка:** http://localhost:5173/admin/ta  

Так вы смотрите **все созданные для просмотра типы объектов** через один и тот же UI, как на trendagent.ru (список/таблица/карта/планировки/карточки), только данные идут с вашего продакшн-API.

### Вариант 2: Раздача фронтенда с того же домена (https://trendagent.siteaccess.ru)

Чтобы открывать эти же страницы прямо по https://trendagent.siteaccess.ru (без localhost):

1. На сервере собрать фронтенд и положить его в каталог, который отдаёт nginx (или в `backend/public` и настроить fallback на `index.html` для SPA).
2. В `frontend` при сборке задать `VITE_API_URL=https://trendagent.siteaccess.ru`, чтобы запросы шли на тот же домен.
3. Настроить nginx так, чтобы:
   - запросы к `/api/*` шли в Laravel;
   - все остальные GET (например `/objects/list`, `/object/…`, `/flat/…`) отдавали `index.html` фронтенда (и статику из папки со сборкой).

Конкретные команды и фрагмент nginx зависят от того, куда именно вы кладёте сборку (например `frontend/dist` или `backend/public`). Если опишете, куда хотите класть — можно расписать пошагово.

---

## Откуда берутся данные в API

- Данные в вашем API (**/api/ta/blocks**, **/api/ta/apartments** и т.д.) — это то, что уже **залито в вашу БД** командами синхронизации (pipeline, sync blocks/apartments).
- Если списки пустые — нужно один раз запустить загрузку, например:
  - через админку: **POST /api/ta/admin/pipeline/run** (с заголовком X-Internal-Key), или
  - соответствующими artisan-командами sync (см. backend/docs и PROD_RUNBOOK).

После успешного sync те же данные появятся в списках, таблице, карте и карточках фронтенда.

---

## Кратко

- **Как всё работает:** TrendAgent API → ваш Laravel (sync в ta_*) → ваш API → ваш Vue-фронтенд (списки, таблица, карта, планировки, карточки объекта и квартиры).
- **Как посмотреть все типы объектов:** запустить фронтенд локально (`npm run dev`) с `VITE_API_URL=https://trendagent.siteaccess.ru` и ходить по разделам: `/objects/list`, `/objects/table`, `/objects/map`, `/objects/plans`, `/object/:id`, `/object/:id/checkerboard`, `/flat/:id`, `/admin/ta`.
- **Создано для просмотра** именно эти представления; полный аналог всех разделов trendagent.ru (парковки, посёлки, коммерция и т.д.) может быть не везде реализован — актуальный набор страниц смотрите в роутере фронтенда и в меню UI.
